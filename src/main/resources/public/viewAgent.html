<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Tableau des interventions - Agent</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<!-- Topbar: agent view with quick actions for assigning and tracking tasks -->
<header class="topbar">
    <div class="left">
        <button class="menu" onclick="location.href='loginPage.html'"> Menu principal</button>
        <div class="divider"></div>
        <span class="welcome">Bonjour agent</span>
    </div>
    <div class="right">
        <!-- notification bell -->
        <div class="notif-wrapper" data-role="agent">
            <button type="button" class="notif-btn" aria-haspopup="true" aria-expanded="false" aria-controls="notifDropdown">
                <svg class="notif-icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <path d="M9.10745 2.67414C9.98414 2.24187 10.9649 2 12 2C15.7274 2 18.7491 5.13623 18.7491 9.00497V9.70957C18.7491 10.5552 18.9903 11.3818 19.4422 12.0854L20.5496 13.8095C21.5612 15.3843 20.789 17.5249 19.0296 18.0229C14.4273 19.3257 9.57274 19.3257 4.97036 18.0229C3.21105 17.5249 2.43882 15.3843 3.45036 13.8095L4.5578 12.0854C5.00972 11.3818 5.25087 10.5552 5.25087 9.70957V9.00497C5.25087 7.93058 5.48391 6.91269 5.90039 6.00277" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"></path>
                        <path d="M7.5 19C8.15503 20.7478 9.92246 22 12 22C12.2445 22 12.4847 21.9827 12.7192 21.9492M16.5 19C16.2329 19.7126 15.781 20.3428 15.1985 20.8393" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"></path>
                    </g>
                </svg>
                <span class="notif-badge">0</span>
            </button>

            <div class="notif-dropdown" id="notifDropdown" aria-hidden="true">
                <div class="notif-header">
                    <h4 id="notifTitle">Notifications</h4>
                    <button class="notif-markread small" data-action="mark-all">Marquer tout lu</button>
                </div>
                <ul class="notif-list" id="notifList"></ul>
                <div class="notif-empty" id="notifEmpty">Aucune notification</div>
                <div class="notif-footer"><a href="/notifications">Voir toutes les notifications</a></div>
            </div>
        </div>

        <button class="btn-outline">
            Suivi des demandes
        </button>
        <button class="btn-outline">
            Changer details d'un probleme
        </button>
    </div>
</header>


<div id="treatmentModalOverlay" class="modal-overlay" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="treatmentTitle">
    <button class="modal-close" id="treatmentCloseBtn" aria-label="Close">&times;</button>
    <h2 id="treatmentTitle" class="modal-title">Traiter la soumission</h2>
    <p class="modal-sub">Détails de la soumission</p>

    <div class="modal-form" id="treatmentContent">
      <div class="field"><strong>ID:</strong> <span id="treat-id"></span></div>
      <div class="field"><strong>Adresse:</strong> <span id="treat-location"></span></div>
      <div class="field"><strong>Arrondissement:</strong> <span id="treat-borough"></span></div>
      <div class="field">
        <label><strong>Type de travaux:</strong>
          <select id="treat-worktype" class="form-control">
            <option value="notDefined">-- Aucun --</option>
            <option value="RoadWork">VOIRIE</option>
            <option value="GazOrElectric">ÉLECTRICITÉ</option>
            <option value="ConstructionOrRenovation">CONSTRUCTION / RÉNOVATION</option>
            <option value="Landscaping">AMÉNAGEMENT</option>
            <option value="PublicsTransportWork">TRANSPORTS</option>
            <option value="SignageAndLighting">ÉCLAIRAGE / SIGNALISATION</option>
            <option value="UndergroundWork">TRAVAUX SOUTERRAINS</option>
            <option value="ResidentialWork">TRAVAUX RÉSIDENTIELS</option>
            <option value="UrbanMaintenance">ENTRETIEN URBAIN</option>
            <option value="TelecommunicationsMaintenance">TÉLÉCOMMUNICATIONS</option>
          </select>
        </label>
      </div>
      <div class="field">
        <label><strong>Priorité:</strong>
          <select id="treat-priority" class="form-control">
            <option value="notAssigned">-- Aucun --</option>
            <option value="low">FAIBLE</option>
            <option value="medium">MOYENNE</option>
            <option value="high">ÉLEVÉE</option>
          </select>
        </label>
      </div>
      <div class="field"><strong>Statut:</strong> <span id="treat-status"></span></div>
      <div class="field"><strong>Description:</strong>
        <div id="treat-description" style="white-space:pre-wrap; margin-top:6px; color:var(--text-soft)"></div>
      </div>
      <div class="field"><strong>Date:</strong> <span id="treat-date"></span></div>

      <div class="field">
        <label for="treat-message">Message (optionnel pour modifications)</label>
        <textarea id="treat-message" class="form-control" rows="3" placeholder="Message pour le résident"></textarea>
      </div>

      <div class="modal-actions">
        <button id="treat-approve" class="btn-primary">Approuver</button>
        <button id="treat-reject" class="btn-outline">Rejeter</button>
        <button id="treat-modify" class="btn-outline">Demander modifications</button>
      </div>
    </div>
  </div>
</div>

<!-- Filters for the agent table: search, status and priority. Behaviour to be added in JS. -->
<section class="search-section">
    <label for="searchInput"></label><input type="text" id="searchInput" placeholder="Rechercher par ID, arrondissement ou priorité...">
    <label for="statusFilter"></label><select id="statusFilter">
        <option value="">Tous les statuts</option>
        <option value="Assigné">Assigné</option>
        <option value="En attente">En attente</option>
        <option value="Complété">Complété</option>
    </select>
    <label for="priorityFilter"></label><select id="priorityFilter">
        <option value="">Toutes les priorités</option>
        <option value="Haute">Haute</option>
        <option value="Moyenne">Moyenne</option>
        <option value="Basse">Basse</option>
    </select>
</section>

<!-- Table of problems -->
<section class="table-container">
    <table id="agentTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>Adresse</th>
            <th>Arrondissement</th>
            <th>Priorité</th>
            <th>Statut</th>
            <th>Date</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="tableBody">
        <tr><td colspan="7" class="loading">Chargement des données...</td></tr>
        </tbody>
    </table>
    <p id="resultCount">Affichage des problèmes déclarés par les résidents</p>
</section>

<footer>
    <p>© Petit Génie - 2025</p>
</footer>
<!-- External script: contains all page behaviour (fetching, modal, form) -->
<script src="viewAgent.js"></script>
<script src="script.js"></script>
<script src="notifications.js"></script>

</body>
</html>
