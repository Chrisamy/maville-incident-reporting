<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Tableau des requêtes - Résident</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<!-- Top bar: navigation and quick actions for the resident user -->
<header class="topbar">
    <div class="left">
        <button class="menu" onclick="location.href='loginPage.html'"> Menu principal</button>
        <div class="divider"></div>
        <span class="welcome">Bonjour résident</span>
    </div>
    <div class="right">
        <!-- notification bell -->
        <div class="notif-wrapper" data-role="resident">
            <button type="button" class="notif-btn" aria-haspopup="true" aria-expanded="false" aria-controls="notifDropdown">
                <svg class="notif-icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <path d="M9.10745 2.67414C9.98414 2.24187 10.9649 2 12 2C15.7274 2 18.7491 5.13623 18.7491 9.00497V9.70957C18.7491 10.5552 18.9903 11.3818 19.4422 12.0854L20.5496 13.8095C21.5612 15.3843 20.789 17.5249 19.0296 18.0229C14.4273 19.3257 9.57274 19.3257 4.97036 18.0229C3.21105 17.5249 2.43882 15.3843 3.45036 13.8095L4.5578 12.0854C5.00972 11.3818 5.25087 10.5552 5.25087 9.70957V9.00497C5.25087 7.93058 5.48391 6.91269 5.90039 6.00277" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"></path>
                        <path d="M7.5 19C8.15503 20.7478 9.92246 22 12 22C12.2445 22 12.4847 21.9827 12.7192 21.9492M16.5 19C16.2329 19.7126 15.781 20.3428 15.1985 20.8393" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"></path>
                    </g>
                </svg>
                <span class="notif-badge">0</span>
            </button>

            <div class="notif-dropdown" id="notifDropdown" aria-hidden="true">
                <div class="notif-header">
                    <h4 id="notifTitle">Notifications</h4>
                    <button class="notif-markread small" data-action="mark-all">Marquer tout lu</button>
                </div>
                <ul class="notif-list" id="notifList"></ul>
                <div class="notif-empty" id="notifEmpty">Aucune notification</div>
                <div class="notif-footer"><a href="/notifications">Voir toutes les notifications</a></div>
            </div>
        </div>

        <button class="btn-outline">
            Registre des travaux
        </button>
        <button class="btn-primary">
            Signaler un problème
        </button>
    </div>
</header>

<!-- Modal used to submit a resident problem report. Controlled from viewResident.js -->
<div id="problemModalOverlay" class="modal-overlay" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <button class="modal-close" id="modalCloseBtn" aria-label="Close">&times;</button>
        <h2 id="modalTitle" class="modal-title">Signaler un problème</h2>
        <p class="modal-sub">Remplissez le formulaire ci-dessous pour signaler un problème dans votre secteur.</p>

        <form id="problemForm" class="modal-form">
            <label>Adresse du problème <span class="required">*</span>
                <input id="addressInput" class="form-control" name="address" type="text" placeholder="Ex: 123 Rue Principale, Montréal" required>
            </label>

            <label>Description détaillée <span class="required">*</span>
                <textarea id="detailsInput" class="form-control" name="details" rows="5" placeholder="Décrivez le problème en détail..." required></textarea>
            </label>

            <label>Arrondissement <span class="required">*</span>
                <select id="boroughSelect" name="borough" class="form-control" required>
                    <option value="">-- Sélectionnez --</option>
                    <option value="ahuntsicCartierville">Ahuntsic-Cartierville</option>
                    <option value="anjou">Anjou</option>
                    <option value="coteDesNeigesNotreDameDeGrace">Côte-des-Neiges—Notre-Dame-de-Grâce</option>
                    <option value="lachine">Lachine</option>
                    <option value="laSalle">LaSalle</option>
                    <option value="lePlateauMontRoyal">Le Plateau-Mont-Royal</option>
                    <option value="leSudOuest">Le Sud-Ouest</option>
                    <option value="mercierHochelagaMaisonneuve">Mercier–Hochelaga–Maisonneuve</option>
                    <option value="montrealNord">Montréal-Nord</option>
                    <option value="outremont">Outremont</option>
                    <option value="pierrefondsRoxboro">Pierrefonds–Roxboro</option>
                    <option value="riviereDesPrairiesPointeAuxTrembles">Rivière-des-Prairies—Pointe-aux-Trembles</option>
                    <option value="rosemontLaPetitePatrie">Rosemont—La Petite-Patrie</option>
                    <option value="saintLeonard">Saint-Léonard</option>
                    <option value="saintLaurent">Saint-Laurent</option>
                    <option value="verdun">Verdun</option>
                    <option value="villeMarie">Ville-Marie</option>
                    <option value="villeraySaintMichelParcExtension">Villeray—Saint-Michel—Parc-Extension</option>
                </select>
            </label>

            <label>Photo (optionnel)</label>
            <div id="fileDrop" class="file-drop">
                <input id="fileInput" type="file" accept="image/png, image/jpeg" />
                <div class="file-drop-inner">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 3v10" stroke="#7b8794" stroke-width="1.5"/><path d="M8 7l4-4 4 4" stroke="#7b8794" stroke-width="1.5"/></svg>
                    <div class="file-drop-text">Cliquez pour ajouter une photo ou glissez-déposez<br><small>PNG, JPG jusqu'à 10MB</small></div>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn-outline" id="cancelBtn">Annuler</button>
                <button type="submit" class="btn-primary">Soumettre</button>
            </div>
        </form>
    </div>
</div>


<!-- Search and filter area: contains both free text search and status filter -->
<section class="search-section">
    <label for="searchInput"></label><input type="text" id="searchInput" placeholder="Rechercher par numéro, arrondissement ou organisation...">
    <label for="statusFilter"></label><select id="statusFilter">
        <option value="">Tous les statuts</option>
        <option value="Permis émis">Permis émis</option>
        <option value="En attente">En attente</option>
        <option value="Fermé">Fermé</option>
    </select>

    <!-- filter by work type for residents -->
    <label for="typeFilter"></label>
    <select id="typeFilter">
        <option value="">Tous les types</option>
        <option value="RoadWork">Travaux routiers</option>
        <option value="GazOrElectric">Travaux de gaz ou électricité</option>
        <option value="ConstructionOrRenovation">Construction ou rénovation</option>
        <option value="Landscaping">Entretien paysager</option>
        <option value="PublicsTransportWork">Travaux liés aux transports en commun</option>
        <option value="SignageAndLighting">Travaux de signalisation et éclairage</option>
        <option value="UndergroundWork">Travaux souterrains</option>
        <option value="ResidentialWork">Travaux résidentiel</option>
        <option value="UrbanMaintenance">Entretien urbain</option>
        <option value="TelecommunicationsMaintenance">Entretien des réseaux de télécommunication</option>
        <option value="notDefined">Autre</option>
    </select>
</section>


<!-- Main table: data is loaded from the Montreal open-data API via viewResident.js -->
<section class="table-container">
    <table id="permitTable">
        <thead>
        <tr>
            <th>Numéro de requête</th>
            <th>Arrondissement</th>
            <th>Type</th>
            <th>Status</th>
            <th>Catégorie du prestataire</th>
            <th>Nom de l'organisation</th>
        </tr>
        </thead>
        <tbody id="tableBody">
        <tr><td colspan="6" class="loading">Chargement des données...</td></tr>
        </tbody>
    </table>
    <p id="resultCount">Affichage des résultats...</p>
</section>

<!-- Footer is static branding/info -->
<footer>
    <p>© Petit Génie - 2025</p>
</footer>

<!-- External script: contains all page behaviour (fetching, modal, form) -->
<script src="viewResident.js"></script>
<script src="notifications.js"></script>
</body>
</html>
